<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IT 자산 관리 대시보드</title>

<style>
  :root {
    --bg:#0f1116;
    --card:#161a22;
    --text:#e5e7eb;
    --muted:#9ca3af;
    --line:#2a2f3a;
  }

  body {
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto;
    background:var(--bg);
    color:var(--text);
  }

  .wrap {
    max-width:1100px;
    margin:32px auto;
    padding:0 16px;
  }

  h1 { margin:0 0 8px; }
  .sub { color:var(--muted); margin:0 0 24px; }

  .kpi {
    display:flex;
    gap:12px;
    margin-bottom:16px;
    flex-wrap:wrap;
  }

  .kpi .card {
    background:var(--card);
    border:1px solid var(--line);
    border-radius:12px;
    padding:12px 16px;
    min-width:110px;
  }

  .kpi .n {
    font-size:20px;
    font-weight:700;
  }

  .toolbar {
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    margin-bottom:16px;
  }

  input, select {
    background:#0b0e14;
    color:var(--text);
    border:1px solid var(--line);
    border-radius:8px;
    padding:10px 12px;
  }

  table {
    width:100%;
    border-collapse:collapse;
    background:var(--card);
    border:1px solid var(--line);
    border-radius:12px;
    overflow:hidden;
  }

  th, td {
    padding:12px;
    border-bottom:1px solid var(--line);
    text-align:left;
  }

  th {
    background:#121620;
    color:#cfd5e1;
    font-weight:600;
  }

  tr:hover { background:#0f1420; }

  .badge {
    display:inline-block;
    padding:2px 8px;
    border-radius:999px;
    font-size:12px;
    border:1px solid var(--line);
  }

  .empty {
    color:var(--muted);
    text-align:center;
    padding:32px;
  }
</style>
</head>

<body>
<div class="wrap">
  <h1>IT 자산 관리 대시보드</h1>
  <p class="sub">GitHub Issues → JSON → GitHub Pages</p>

  <!-- KPI -->
  <div class="kpi">
    <div class="card">총 자산<div class="n" id="k-total">0</div></div>
    <div class="card">IN<div class="n" id="k-in">0</div></div>
    <div class="card">OUT<div class="n" id="k-out">0</div></div>
    <div class="card">수리중<div class="n" id="k-repair">0</div></div>
    <div class="card">폐기<div class="n" id="k-retired">0</div></div>
  </div>

  <!-- 검색 / 필터 -->
  <div class="toolbar">
    <input id="q" placeholder="검색: 구분/모델명/본문/사용자…" />
    <select id="status">
      <option value="">상태 전체</option>
      <option value="in">IN</option>
      <option value="out">OUT</option>
      <option value="repair">수리중</option>
      <option value="retired">폐기</option>
    </select>
  </div>

  <!-- 테이블 -->
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>구분</th>
        <th>모델명</th>
        <th>시리얼</th>
        <th>사용자</th>
        <th>구매일</th>
        <th>상태</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <div class="empty" id="empty" style="display:none;">표시할 자산이 없습니다.</div>
</div>

<script>
async function main(){
  const res = await fetch('assets.json', {cache:'no-store'});
  const issues = await res.json();

  const assets = issues.map(i => {
    const body = i.body || '';
    const labels = (i.labels || []).map(l => l.toLowerCase());

    let state = '';
    if (labels.includes('in')) state = 'IN';
    else if (labels.includes('out')) state = 'OUT';
    else if (labels.includes('repair')) state = '수리중';
    else if (labels.includes('retired')) state = '폐기';

    const pick = r => {
      const m = body.match(r);
      return m ? m[1].trim() : '-';
    };

    return {
      number: i.number,
      type: pick(/구분:\s*(.+)/),
      model: i.title,
      serial: pick(/시리얼:\s*(.+)/),
      user: pick(/사용자:\s*(.+)/),
      buy: pick(/구매일:\s*([0-9\-\.]+)/).replace(/\./g,'-'),
      state,
      hay: (body + ' ' + i.title).toLowerCase()
    };
  });

  // KPI
  document.getElementById('k-total').textContent = assets.length;
  document.getElementById('k-in').textContent = assets.filter(a=>a.state==='IN').length;
  document.getElementById('k-out').textContent = assets.filter(a=>a.state==='OUT').length;
  document.getElementById('k-repair').textContent = assets.filter(a=>a.state==='수리중').length;
  document.getElementById('k-retired').textContent = assets.filter(a=>a.state==='폐기').length;

  const tbody = document.getElementById('tbody');
  const empty = document.getElementById('empty');

  function render(){
    const q = document.getElementById('q').value.toLowerCase();
    const st = document.getElementById('status').value;

    const rows = assets.filter(a=>{
      return (!q || a.hay.includes(q)) &&
             (!st || a.state.toLowerCase() === st);
    });

    tbody.innerHTML = rows.map(a=>`
      <tr>
        <td>${a.number}</td>
        <td>${a.type}</td>
        <td>${a.model}</td>
        <td>${a.serial}</td>
        <td>${a.user}</td>
        <td>${a.buy}</td>
        <td><span class="badge">${a.state}</span></td>
      </tr>
    `).join('');

    empty.style.display = rows.length ? 'none' : 'block';
  }

  document.getElementById('q').addEventListener('input', render);
  document.getElementById('status').addEventListener('change', render);

  render();
}

main();
</script>
</body>
</html>
