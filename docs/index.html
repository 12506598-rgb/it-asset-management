<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IT ìì‚° ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</title>

<style>
  :root{
    --bg: radial-gradient(1200px 600px at 20% -10%, #1b2559 0%, #0b0f1a 45%, #05070c 100%);
    --card: rgba(18, 24, 48, 0.86);
    --text: #e8ecff;
    --muted: #9aa4ff;
    --line: rgba(120, 140, 255, 0.18);
    --accent: #6cf0ff;
    --accent2: #a78bfa;
    --shadow: 0 20px 60px rgba(0,0,0,.45);
  }

  *{ box-sizing: border-box; }

  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
  }

  /* ğŸŒŸ ì •ì  ë³„(ì ) íŒ¨í„´: ì„±ëŠ¥ ë¶€ë‹´ ê±°ì˜ ì—†ìŒ */
  body::before{
    content:"";
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
    opacity: .35;
    background-image:
      radial-gradient(1px 1px at 12% 18%, rgba(255,255,255,.75) 0, transparent 55%),
      radial-gradient(1px 1px at 22% 78%, rgba(255,255,255,.55) 0, transparent 55%),
      radial-gradient(1px 1px at 36% 42%, rgba(255,255,255,.6) 0, transparent 55%),
      radial-gradient(1px 1px at 48% 16%, rgba(255,255,255,.5) 0, transparent 55%),
      radial-gradient(1px 1px at 58% 68%, rgba(255,255,255,.6) 0, transparent 55%),
      radial-gradient(1px 1px at 66% 30%, rgba(255,255,255,.55) 0, transparent 55%),
      radial-gradient(1px 1px at 74% 86%, rgba(255,255,255,.65) 0, transparent 55%),
      radial-gradient(1px 1px at 82% 44%, rgba(255,255,255,.5) 0, transparent 55%),
      radial-gradient(1px 1px at 90% 22%, rgba(255,255,255,.6) 0, transparent 55%),
      radial-gradient(2px 2px at 15% 55%, rgba(108,240,255,.22) 0, transparent 60%),
      radial-gradient(2px 2px at 70% 15%, rgba(167,139,250,.18) 0, transparent 60%),
      radial-gradient(2px 2px at 85% 75%, rgba(108,240,255,.14) 0, transparent 60%);
    mix-blend-mode: screen;
  }

  /* ğŸŒ«ï¸ ì€ì€í•œ ìš°ì£¼ ì•ˆê°œ ë ˆì´ì–´ */
  body::after{
    content:"";
    position: fixed;
    inset: -20%;
    pointer-events: none;
    z-index: 0;
    opacity: .25;
    background:
      radial-gradient(500px 220px at 20% 30%, rgba(108,240,255,.18), transparent 65%),
      radial-gradient(520px 240px at 75% 65%, rgba(167,139,250,.16), transparent 68%),
      radial-gradient(420px 200px at 55% 15%, rgba(120,140,255,.14), transparent 70%);
    filter: blur(10px);
  }

  .wrap{
    max-width:1100px;
    margin:36px auto;
    padding:0 16px;
    position: relative;
    z-index: 1; /* ë³„/ì•ˆê°œ ìœ„ë¡œ */
  }

  h1{
    margin:0 0 8px;
    letter-spacing: .4px;
  }

  .sub{
    color: var(--muted);
    margin:0 0 24px;
  }

  .kpi{
    display:flex;
    gap:12px;
    margin:0 0 12px;
    flex-wrap:wrap;
  }

  .kpi .card{
    background:
      linear-gradient(180deg, rgba(80,100,255,.14), rgba(0,0,0,.35)),
      var(--card);
    border:1px solid var(--line);
    border-radius:16px;
    padding:12px 16px;
    cursor:pointer;
    box-shadow: 0 0 0 1px rgba(120,140,255,.05), 0 12px 40px rgba(30,40,120,.35);
    transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
  }

  .kpi .card:hover{
    transform: translateY(-2px);
    border-color: var(--accent);
    box-shadow: 0 0 12px rgba(108,240,255,.25), 0 18px 60px rgba(30,40,120,.45);
  }

  .kpi .card.active{
    border-color: var(--accent2);
    box-shadow: 0 0 16px rgba(167,139,250,.35), 0 20px 70px rgba(80,60,200,.45);
  }

  .kpi .n{
    font-size:22px;
    font-weight:800;
    color: var(--accent);
    margin-top: 4px;
  }

  .summary{
    margin:0 0 16px;
    background: var(--card);
    border:1px solid var(--line);
    border-radius:16px;
    padding:12px 16px;
    font-size:14px;
    color: var(--text);
    box-shadow: var(--shadow);
    position: relative;
    overflow: hidden;
  }

  /* summary ì‚´ì§ í•˜ì´ë¼ì´íŠ¸ */
  .summary::before{
    content:"";
    position:absolute;
    inset:-1px;
    pointer-events:none;
    background: radial-gradient(600px 220px at 10% 0%, rgba(108,240,255,.12), transparent 60%);
    opacity:.9;
  }

  .summary h2{
    margin:0 0 10px;
    font-size:15px;
    color: var(--accent2);
    position: relative;
  }

  .summary table{
    width:100%;
    border-collapse:collapse;
    margin-top:4px;
    position: relative;
  }

  .summary th, .summary td{
    padding:6px 8px;
    border-bottom:1px solid var(--line);
    font-size:13px;
  }

  .summary th{
    background: linear-gradient(180deg, rgba(120,140,255,.18), rgba(0,0,0,.35));
  }

  .toolbar{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    margin-bottom:16px;
  }

  input, select{
    background: rgba(8,12,28,.82);
    color: var(--text);
    border:1px solid var(--line);
    border-radius:12px;
    padding:10px 12px;
    outline:none;
  }

  input:focus, select:focus{
    border-color: var(--accent);
    box-shadow: 0 0 0 2px rgba(108,240,255,.18);
  }

  table{
    width:100%;
    border-collapse:separate;
    border-spacing:0;
    background: var(--card);
    border:1px solid var(--line);
    border-radius:16px;
    overflow:hidden;
    box-shadow: var(--shadow);
    position: relative;
  }

  th, td{
    padding:12px;
    border-bottom:1px solid var(--line);
    text-align:left;
  }

  th{
    background: linear-gradient(180deg, rgba(120,140,255,.18), rgba(0,0,0,.35));
    color:#dbe1ff;
    font-weight:600;
  }

  /* âœ¨ í…Œì´ë¸” í–‰ í•˜ì´ë¼ì´íŠ¸ + ê¸€ë¡œìš° */
  tbody tr{
    position: relative;
    transition: background .15s ease, box-shadow .15s ease, transform .1s ease;
  }

  tbody tr::before{
    content:"";
    position:absolute;
    inset:0;
    pointer-events:none;
    opacity:0;
    transition: opacity .15s ease;
    background: linear-gradient(90deg, rgba(108,240,255,.10), rgba(167,139,250,.08), rgba(108,240,255,.06));
  }

  tbody tr:hover{
    background: rgba(120,140,255,.06);
    transform: translateY(-1px);
    box-shadow:
      inset 0 0 0 1px rgba(108,240,255,.18),
      0 0 18px rgba(108,240,255,.10);
  }

  tbody tr:hover::before{
    opacity: 1;
  }

  /* ì²« ì—´ì— ì€ì€í•œ í¬ì»¤ìŠ¤ ë¼ì¸ */
  tbody tr:hover td:first-child{
    box-shadow: inset 3px 0 0 0 rgba(108,240,255,.35);
  }

  .empty{
    color: var(--muted);
    text-align:center;
    padding:32px;
  }
</style>
</head>

<body>
<div class="wrap">
  <h1>ğŸ›°ï¸ IT ìì‚° ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h1>
  <p class="sub">GitHub Issues â†’ JSON(ì•¡ì…˜) â†’ GitHub Pages</p>

  <!-- KPI ì¹´ë“œ -->
  <div class="kpi">
    <div class="card" id="card-total">
      ì´ ìì‚°
      <div class="n" id="k-total">0</div>
    </div>
    <div class="card" id="card-in">
      IN
      <div class="n" id="k-in">0</div>
    </div>
    <div class="card" id="card-out">
      OUT
      <div class="n" id="k-out">0</div>
    </div>
    <div class="card" id="card-repair">
      ìˆ˜ë¦¬ì¤‘
      <div class="n" id="k-repair">0</div>
    </div>
    <div class="card" id="card-retired">
      íê¸°
      <div class="n" id="k-retired">0</div>
    </div>
  </div>

  <!-- KPI í´ë¦­ ìš”ì•½ -->
  <div class="summary" id="summary"></div>

  <!-- ê²€ìƒ‰ / í•„í„° -->
  <div class="toolbar">
    <input id="q" placeholder="ê²€ìƒ‰: êµ¬ë¶„/ëª¨ë¸ëª…/ë³¸ë¬¸/ì‚¬ìš©ì/ì‹œë¦¬ì–¼â€¦" />
    <select id="status">
      <option value="">ìƒíƒœ(IN/OUT/ìˆ˜ë¦¬/íê¸°) ì „ì²´</option>
      <option value="in">IN</option>
      <option value="out">OUT</option>
      <option value="repair">ìˆ˜ë¦¬ì¤‘</option>
      <option value="retired">íê¸°</option>
      <option value="lost">ë¶„ì‹¤</option>
    </select>
    <select id="state">
      <option value="">ì´ìŠˆ ìƒíƒœ ì „ì²´</option>
      <option value="open">open</option>
      <option value="closed">closed</option>
    </select>
  </div>

  <!-- ìì‚° í…Œì´ë¸” -->
  <table id="tbl">
    <thead>
      <tr>
        <th style="width:72px">#</th>
        <th style="width:120px">êµ¬ë¶„</th>
        <th>ëª¨ë¸ëª…</th>
        <th style="width:180px">ì‹œë¦¬ì–¼ ë²ˆí˜¸</th>
        <th style="width:160px">ì‚¬ìš©ì</th>
        <th style="width:150px">êµ¬ë§¤ì¼</th>
        <th style="width:120px">ìƒíƒœ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div class="empty" id="empty" style="display:none;">í‘œì‹œí•  ìì‚°ì´ ì—†ìŠµë‹ˆë‹¤.</div>
</div>

<script>
async function main(){
  const res = await fetch('assets.json', {cache:'no-store'});
  const issues = await res.json();

  // ---------- ì´ìŠˆ -> ìì‚° ë°ì´í„°ë¡œ ë³€í™˜ (ëª¨ë“  ì´ìŠˆ 1:1 ë°˜ì˜) ----------
  const assets = [];
  for (const i of issues) {
    const body = i.body || '';

    const labels = (i.labels || []).map(x =>
      (typeof x === 'string' ? x : (x.name || '')).toLowerCase()
    );

    // ìƒíƒœ í‚¤
    let stateKey = '';
    if (labels.includes('in')) stateKey = 'in';
    else if (labels.includes('out')) stateKey = 'out';
    else if (labels.includes('repair')) stateKey = 'repair';
    else if (labels.includes('retired')) stateKey = 'retired';
    else if (labels.includes('lost')) stateKey = 'lost';

    // êµ¬ë¶„
    let mType = body.match(/ì¥ë¹„êµ¬ë¶„:\s*(.+)/);
    if (!mType) mType = body.match(/êµ¬ë¶„:\s*(.+)/);
    const deviceType = mType ? mType[1].trim() : '-';

    // ëª¨ë¸ëª… = ì œëª©
    const model = i.title || '-';

    // ì‹œë¦¬ì–¼
    const mSerial = body.match(/ì‹œë¦¬ì–¼:\s*(.+)/);
    const serial = mSerial ? mSerial[1].trim() : '-';

    // ì‚¬ìš©ì
    let mUser = body.match(/ì‚¬ìš©ì:\s*(.+)/);
    if (!mUser) mUser = body.match(/ë‹´ë‹¹ì:\s*(.+)/);
    const user = mUser ? mUser[1].trim() : '-';

    // êµ¬ë§¤ì¼
    const mBuy = body.match(/êµ¬ë§¤ì¼:\s*([0-9\-\.\/]+)/);
    const buy = mBuy ? mBuy[1].replace(/\./g,'-') : '-';

    const searchHay = (deviceType + ' ' + model + ' ' + body + ' ' + labels.join(' ')).toLowerCase();

    assets.push({
      number: i.number,
      issueState: i.state,
      labels,
      stateKey,
      deviceType,
      model,
      serial,
      user,
      buy,
      searchHay
    });
  }

  // ---------- KPI ----------
  document.getElementById('k-total').textContent = assets.length;
  const countByState = key => assets.filter(a => a.stateKey === key).length;
  document.getElementById('k-in').textContent      = countByState('in');
  document.getElementById('k-out').textContent     = countByState('out');
  document.getElementById('k-repair').textContent  = countByState('repair');
  document.getElementById('k-retired').textContent = countByState('retired');

  const tbody = document.querySelector('#tbl tbody');
  const empty = document.getElementById('empty');
  const summaryEl = document.getElementById('summary');

  // ---------- í…Œì´ë¸” ë Œë” ----------
  function renderTable(){
    const q      = document.getElementById('q').value.trim().toLowerCase();
    const st     = document.getElementById('status').value;   // in/out/repair/retired/lost
    const istate = document.getElementById('state').value;    // open/closed

    const rows = assets.filter(a => {
      const labelHit = st ? (a.stateKey === st) : true;
      const stateHit = istate ? (a.issueState === istate) : true;
      const qHit     = q ? a.searchHay.includes(q) : true;
      return labelHit && stateHit && qHit;
    });

    tbody.innerHTML = rows.map(a => {
      let stateDisplay = '-';
      if (a.stateKey === 'in')      stateDisplay = 'IN';
      else if (a.stateKey === 'out')    stateDisplay = 'OUT';
      else if (a.stateKey === 'repair') stateDisplay = 'ìˆ˜ë¦¬ì¤‘';
      else if (a.stateKey === 'retired')stateDisplay = 'íê¸°';
      else if (a.stateKey === 'lost')   stateDisplay = 'ë¶„ì‹¤';

      return `<tr>
        <td>${a.number}</td>
        <td>${a.deviceType}</td>
        <td>${a.model}</td>
        <td>${a.serial}</td>
        <td>${a.user}</td>
        <td>${a.buy}</td>
        <td>${stateDisplay}</td>
      </tr>`;
    }).join('');

    empty.style.display = rows.length ? 'none' : 'block';
  }

  // ---------- ìš”ì•½(KPI í´ë¦­) ----------
  function renderSummary(mode){
    let filtered = assets;
    let title = 'ì „ì²´ ìì‚° í˜„í™©';

    if (mode !== 'total') {
      filtered = assets.filter(a => a.stateKey === mode);
      if (mode === 'in') title = 'IN ìì‚° í˜„í™©';
      else if (mode === 'out') title = 'OUT ìì‚° í˜„í™©';
      else if (mode === 'repair') title = 'ìˆ˜ë¦¬ì¤‘ ìì‚° í˜„í™©';
      else if (mode === 'retired') title = 'íê¸° ìì‚° í˜„í™©';
    }

    const map = {};
    for (const a of filtered) {
      const key = a.deviceType || '-';
      if (!map[key]) map[key] = { total:0, in:0, out:0, repair:0, retired:0, lost:0 };
      map[key].total++;
      if (a.stateKey && map[key][a.stateKey] !== undefined) {
        map[key][a.stateKey]++;
      }
    }

    const types = Object.keys(map).sort();
    if (!types.length) {
      summaryEl.innerHTML = `<h2>${title}</h2><p style="color:var(--muted);margin:4px 0 0;">í•´ë‹¹ ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ìì‚°ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
      return;
    }

    const rowsHtml = types.map(t => {
      const s = map[t];
      return `<tr>
        <td>${t}</td>
        <td style="text-align:right;">${s.total}</td>
        <td style="text-align:right;">${s.in}</td>
        <td style="text-align:right;">${s.out}</td>
        <td style="text-align:right;">${s.repair}</td>
        <td style="text-align:right;">${s.retired}</td>
        <td style="text-align:right;">${s.lost}</td>
      </tr>`;
    }).join('');

    summaryEl.innerHTML = `
      <h2>${title}</h2>
      <table>
        <thead>
          <tr>
            <th>êµ¬ë¶„</th>
            <th style="width:70px;text-align:right;">ì „ì²´</th>
            <th style="width:70px;text-align:right;">IN</th>
            <th style="width:70px;text-align:right;">OUT</th>
            <th style="width:70px;text-align:right;">ìˆ˜ë¦¬ì¤‘</th>
            <th style="width:70px;text-align:right;">íê¸°</th>
            <th style="width:70px;text-align:right;">ë¶„ì‹¤</th>
          </tr>
        </thead>
        <tbody>${rowsHtml}</tbody>
      </table>
    `;
  }

  function setActiveCard(mode){
    ['total','in','out','repair','retired'].forEach(m => {
      const el = document.getElementById('card-' + m);
      if (!el) return;
      if (m === mode) el.classList.add('active');
      else el.classList.remove('active');
    });
  }

  // ì´ë²¤íŠ¸
  ['q','status','state'].forEach(id =>
    document.getElementById(id).addEventListener('input', renderTable)
  );

  document.getElementById('card-total').addEventListener('click', () => {
    setActiveCard('total'); renderSummary('total');
  });
  document.getElementById('card-in').addEventListener('click', () => {
    setActiveCard('in'); renderSummary('in');
  });
  document.getElementById('card-out').addEventListener('click', () => {
    setActiveCard('out'); renderSummary('out');
  });
  document.getElementById('card-repair').addEventListener('click', () => {
    setActiveCard('repair'); renderSummary('repair');
  });
  document.getElementById('card-retired').addEventListener('click', () => {
    setActiveCard('retired'); renderSummary('retired');
  });

  // ì´ˆê¸° ë Œë”
  renderTable();
  setActiveCard('total');
  renderSummary('total');
}

main().catch(e => {
  console.error(e);
  document.getElementById('empty').style.display='block';
  const summaryEl = document.getElementById('summary');
  if (summaryEl) summaryEl.innerHTML = '<p style="color:var(--muted);margin:0;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
});
</script>
</body>
</html>
