<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IT ìì‚° ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</title>

<style>
  :root {
    --bg:#0f1116;
    --card:#161a22;
    --text:#e5e7eb;
    --muted:#9ca3af;
    --line:#2a2f3a;
  }

  body {
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto;
    background:var(--bg);
    color:var(--text);
  }

  .wrap {
    max-width:1100px;
    margin:32px auto;
    padding:0 16px;
  }

  h1 { margin:0 0 8px; }
  .sub { color:var(--muted); margin:0 0 24px; }

  .kpi {
    display:flex;
    gap:12px;
    margin-bottom:16px;
    flex-wrap:wrap;
  }

  .kpi .card {
    background:var(--card);
    border:1px solid var(--line);
    border-radius:12px;
    padding:12px 16px;
    min-width:110px;
  }

  .kpi .n {
    font-size:20px;
    font-weight:700;
  }

  .toolbar {
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    margin-bottom:16px;
  }

  input, select {
    background:#0b0e14;
    color:var(--text);
    border:1px solid var(--line);
    border-radius:8px;
    padding:10px 12px;
  }

  table {
    width:100%;
    border-collapse:collapse;
    background:var(--card);
    border:1px solid var(--line);
    border-radius:12px;
    overflow:hidden;
  }

  th, td {
    padding:12px;
    border-bottom:1px solid var(--line);
    text-align:left;
  }

  th {
    background:#121620;
    color:#cfd5e1;
    font-weight:600;
  }

  tr:hover { background:#0f1420; }

  .badge {
    display:inline-block;
    padding:2px 8px;
    border-radius:999px;
    font-size:12px;
    border:1px solid var(--line);
  }

  .btn {
    padding:6px 10px;
    border-radius:8px;
    border:1px solid var(--line);
    background:#0b0e14;
    color:var(--text);
    cursor:pointer;
    font-size:12px;
  }

  .btn:hover {
    background:#141a2a;
  }

  .empty {
    color:var(--muted);
    text-align:center;
    padding:32px;
  }
</style>
</head>

<body>
<div class="wrap">
  <h1>IT ìì‚° ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h1>
  <p class="sub">GitHub Issues â†’ JSON â†’ GitHub Pages</p>

  <!-- KPI -->
  <div class="kpi">
    <div class="card">ì´ ìì‚°<div class="n" id="k-total">0</div></div>
    <div class="card">IN<div class="n" id="k-in">0</div></div>
    <div class="card">OUT<div class="n" id="k-out">0</div></div>
    <div class="card">ìˆ˜ë¦¬ì¤‘<div class="n" id="k-repair">0</div></div>
    <div class="card">íê¸°<div class="n" id="k-retired">0</div></div>
  </div>

  <!-- ê²€ìƒ‰ / í•„í„° -->
  <div class="toolbar">
    <input id="q" placeholder="ê²€ìƒ‰: êµ¬ë¶„/ëª¨ë¸ëª…/ë³¸ë¬¸/ì‚¬ìš©ìâ€¦" />
    <select id="status">
      <option value="">ìƒíƒœ ì „ì²´</option>
      <option value="in">IN</option>
      <option value="out">OUT</option>
      <option value="repair">ìˆ˜ë¦¬ì¤‘</option>
      <option value="retired">íê¸°</option>
    </select>
  </div>

  <!-- í…Œì´ë¸” -->
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>êµ¬ë¶„</th>
        <th>ëª¨ë¸ëª…</th>
        <th>ì‹œë¦¬ì–¼</th>
        <th>ì‚¬ìš©ì</th>
        <th>êµ¬ë§¤ì¼</th>
        <th>ìƒíƒœ</th>
        <th>ë°”ì½”ë“œ</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <div class="empty" id="empty" style="display:none;">í‘œì‹œí•  ìì‚°ì´ ì—†ìŠµë‹ˆë‹¤.</div>
</div>

<script>
async function main(){
  const res = await fetch('assets.json', {cache:'no-store'});
  const issues = await res.json();

  const assets = issues.map(i => {
    const body = i.body || '';
    const labels = (i.labels || []).map(l => l.toLowerCase());

    let state = '';
    if (labels.includes('in')) state = 'IN';
    else if (labels.includes('out')) state = 'OUT';
    else if (labels.includes('repair')) state = 'ìˆ˜ë¦¬ì¤‘';
    else if (labels.includes('retired')) state = 'íê¸°';

    const pick = r => {
      const m = body.match(r);
      return m ? m[1].trim() : '-';
    };

    return {
      number: i.number,
      type: pick(/êµ¬ë¶„:\s*(.+)/),
      model: i.title,
      serial: pick(/ì‹œë¦¬ì–¼:\s*(.+)/),
      user: pick(/ì‚¬ìš©ì:\s*(.+)/),
      buy: pick(/êµ¬ë§¤ì¼:\s*([0-9\-\.]+)/).replace(/\./g,'-'),
      state,
      hay: (body + ' ' + i.title).toLowerCase()
    };
  });

  // KPI
  document.getElementById('k-total').textContent = assets.length;
  document.getElementById('k-in').textContent = assets.filter(a=>a.state==='IN').length;
  document.getElementById('k-out').textContent = assets.filter(a=>a.state==='OUT').length;
  document.getElementById('k-repair').textContent = assets.filter(a=>a.state==='ìˆ˜ë¦¬ì¤‘').length;
  document.getElementById('k-retired').textContent = assets.filter(a=>a.state==='íê¸°').length;

  const tbody = document.getElementById('tbody');
  const empty = document.getElementById('empty');

  function render(){
    const q = document.getElementById('q').value.toLowerCase();
    const st = document.getElementById('status').value;

    const rows = assets.filter(a=>{
      return (!q || a.hay.includes(q)) &&
             (!st || a.state.toLowerCase() === st);
    });

    tbody.innerHTML = rows.map(a=>`
      <tr>
        <td>${a.number}</td>
        <td>${a.type}</td>
        <td>${a.model}</td>
        <td>${a.serial}</td>
        <td>${a.user}</td>
        <td>${a.buy}</td>
        <td><span class="badge">${a.state}</span></td>
        <td>
          <button class="btn" onclick="printAsset('${a.model}','${a.serial}','${a.user}','${a.buy}')">
            ì¸ì‡„
          </button>
        </td>
      </tr>
    `).join('');

    empty.style.display = rows.length ? 'none' : 'block';
  }

  document.getElementById('q').addEventListener('input', render);
  document.getElementById('status').addEventListener('change', render);

  render();
}

/* ğŸ”¹ ì¸ì‡„ ì „ìš© ì°½ */
function printAsset(model, serial, user, buy){
  const w = window.open('', '_blank', 'width=500,height=400');
  w.document.write(`
    <html>
    <head>
      <title>ìì‚° ì¸ì‡„</title>
      <style>
        body{font-family:sans-serif;padding:24px;}
        h2{margin-bottom:16px;}
        p{margin:6px 0;}
      </style>
    </head>
    <body>
      <h2>IT ìì‚° ì •ë³´</h2>
      <p><strong>ëª¨ë¸ëª…:</strong> ${model}</p>
      <p><strong>ì‹œë¦¬ì–¼:</strong> ${serial}</p>
      <p><strong>ì‚¬ìš©ì:</strong> ${user}</p>
      <p><strong>êµ¬ë§¤ì¼:</strong> ${buy}</p>
      <hr/>
      <button onclick="window.print()">ì¸ì‡„</button>
    </body>
    </html>
  `);
  w.document.close();
}

main();
</script>
</body>
</html>
