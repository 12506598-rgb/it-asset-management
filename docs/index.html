<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IT ìì‚° ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</title>
<style>
  :root { --bg:#0f1116; --card:#161a22; --text:#e5e7eb; --muted:#9ca3af; --line:#2a2f3a; }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto; background:var(--bg); color:var(--text);}
  .wrap { max-width:1100px; margin:32px auto; padding:0 16px; }
  h1 { margin:0 0 8px; }
  .sub { color:var(--muted); margin:0 0 24px; }
  .toolbar { display:flex; gap:12px; flex-wrap:wrap; margin-bottom:16px; }
  input, select { background:#0b0e14; color:var(--text); border:1px solid var(--line); border-radius:8px; padding:10px 12px; }
  table { width:100%; border-collapse:collapse; background:var(--card); border:1px solid var(--line); border-radius:12px; overflow:hidden; }
  th, td { padding:12px; border-bottom:1px solid var(--line); text-align:left; }
  th { background:#121620; color:#cfd5e1; font-weight:600; }
  tr:hover { background:#0f1420; }
  .empty { color:var(--muted); text-align:center; padding:32px; }
  .kpi { display:flex; gap:12px; margin:0 0 12px; flex-wrap:wrap; }
  .kpi .card { background:var(--card); border:1px solid var(--line); border-radius:12px; padding:12px 16px; cursor:pointer; transition:background .15s, transform .1s, box-shadow .15s, border-color .15s; }
  .kpi .card:hover { transform:translateY(-1px); }
  .kpi .card.active { border-color:#4b5563; box-shadow:0 0 0 1px #4b5563; }
  .kpi .n { font-size:20px; font-weight:700; }

  .summary { margin:0 0 16px; background:var(--card); border:1px solid var(--line); border-radius:12px; padding:12px 16px; font-size:14px; color:var(--text); }
  .summary h2 { margin:0 0 8px; font-size:15px; }
  .summary table { width:100%; border-collapse:collapse; margin-top:4px; }
  .summary th, .summary td { padding:6px 8px; border-bottom:1px solid var(--line); font-size:13px; }
  .summary th { background:#121620; }
</style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ’¼ IT ìì‚° ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h1>
  <p class="sub">GitHub Issues â†’ JSON(ì•¡ì…˜) â†’ GitHub Pages</p>

  <!-- KPI ì¹´ë“œ: ì´ ìì‚° / IN / OUT / ìˆ˜ë¦¬ì¤‘ / íê¸° -->
  <div class="kpi">
    <div class="card" id="card-total">
      ì´ ìì‚°
      <div class="n" id="k-total">0</div>
    </div>
    <div class="card" id="card-in">
      IN
      <div class="n" id="k-in">0</div>
    </div>
    <div class="card" id="card-out">
      OUT
      <div class="n" id="k-out">0</div>
    </div>
    <div class="card" id="card-repair">
      ìˆ˜ë¦¬ì¤‘
      <div class="n" id="k-repair">0</div>
    </div>
    <div class="card" id="card-retired">
      íê¸°
      <div class="n" id="k-retired">0</div>
    </div>
  </div>

  <!-- KPI í´ë¦­ ì‹œ í‘œì‹œë˜ëŠ” ìš”ì•½ ì˜ì—­ -->
  <div class="summary" id="summary"></div>

  <!-- ê²€ìƒ‰ / í•„í„° ì˜ì—­ -->
  <div class="toolbar">
    <input id="q" placeholder="ê²€ìƒ‰: êµ¬ë¶„/ëª¨ë¸ëª…/ë³¸ë¬¸/ì‚¬ìš©ì/ì‹œë¦¬ì–¼â€¦" />
    <select id="status">
      <option value="">ìƒíƒœ(IN/OUT/ìˆ˜ë¦¬/íê¸°) ì „ì²´</option>
      <option value="in">IN</option>
      <option value="out">OUT</option>
      <option value="repair">ìˆ˜ë¦¬ì¤‘</option>
      <option value="retired">íê¸°</option>
      <option value="lost">ë¶„ì‹¤</option>
    </select>
    <select id="state">
      <option value="">ì´ìŠˆ ìƒíƒœ ì „ì²´</option>
      <option value="open">open</option>
      <option value="closed">closed</option>
    </select>
  </div>

  <!-- ìì‚° í…Œì´ë¸”: êµ¬ë¶„ / ëª¨ë¸ëª… / ì‹œë¦¬ì–¼ ë²ˆí˜¸ / ì‚¬ìš©ì / êµ¬ë§¤ì¼ / ìƒíƒœ -->
  <table id="tbl">
    <thead>
      <tr>
        <th style="width:72px">#</th>
        <th style="width:120px">êµ¬ë¶„</th>
        <th>ëª¨ë¸ëª…</th>
        <th style="width:180px">ì‹œë¦¬ì–¼ ë²ˆí˜¸</th>
        <th style="width:160px">ì‚¬ìš©ì</th>
        <th style="width:150px">êµ¬ë§¤ì¼</th>
        <th style="width:120px">ìƒíƒœ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div class="empty" id="empty" style="display:none;">í‘œì‹œí•  ìì‚°ì´ ì—†ìŠµë‹ˆë‹¤.</div>
</div>

<script>
async function main(){
  const res = await fetch('assets.json', {cache:'no-store'});
  const issues = await res.json();

  // ---------- ì´ìŠˆ -> ìì‚° ë°ì´í„° ì „ì²˜ë¦¬ ----------
  const assets = issues.map(i => {
    const body = i.body || '';

    // ë¼ë²¨(ì†Œë¬¸ì) ë°°ì—´
    const labels = (i.labels || []).map(x =>
      (typeof x === 'string' ? x : (x.name || '')).toLowerCase()
    );

    // ìƒíƒœ í‚¤(in/out/repair/retired/lost/none)
    let stateKey = '';
    if (labels.includes('in')) stateKey = 'in';
    else if (labels.includes('out')) stateKey = 'out';
    else if (labels.includes('repair')) stateKey = 'repair';
    else if (labels.includes('retired')) stateKey = 'retired';
    else if (labels.includes('lost')) stateKey = 'lost';
    else stateKey = '';

    // êµ¬ë¶„(ë…¸íŠ¸ë¶/ëª¨ë‹ˆí„° ë“±) : "ì¥ë¹„êµ¬ë¶„:" ë˜ëŠ” "êµ¬ë¶„:" íŒ¨í„´
    let mType = body.match(/ì¥ë¹„êµ¬ë¶„:\s*(.+)/);
    if (!mType) mType = body.match(/êµ¬ë¶„:\s*(.+)/);
    const deviceType = mType ? mType[1].trim() : '-';

    // ëª¨ë¸ëª… = ì œëª©
    const model = i.title;

    // ì‹œë¦¬ì–¼ ë²ˆí˜¸
    const mSerial = body.match(/ì‹œë¦¬ì–¼:\s*(.+)/);
    const serial = mSerial ? mSerial[1].trim() : '-';

    // ì‚¬ìš©ì: "ì‚¬ìš©ì:" ë˜ëŠ” "ë‹´ë‹¹ì:"
    let mUser = body.match(/ì‚¬ìš©ì:\s*(.+)/);
    if (!mUser) mUser = body.match(/ë‹´ë‹¹ì:\s*(.+)/);
    const user = mUser ? mUser[1].trim() : '-';

    // êµ¬ë§¤ì¼
    const mBuy = body.match(/êµ¬ë§¤ì¼:\s*([0-9\-\.\/]+)/);
    const buy = mBuy ? mBuy[1].replace(/\./g,'-') : '-';

    // ê²€ìƒ‰ìš© ë¬¸ìì—´
    const searchHay = (deviceType + ' ' + model + ' ' + body + ' ' + labels.join(' ')).toLowerCase();

    return {
      number: i.number,
      issueState: i.state,   // open/closed
      labels,
      stateKey,
      deviceType,
      model,
      serial,
      user,
      buy,
      searchHay
    };
  });

  // ---------- KPI ê³„ì‚° ----------
  document.getElementById('k-total').textContent = assets.length;

  const countByState = key => assets.filter(a => a.stateKey === key).length;
  document.getElementById('k-in').textContent      = countByState('in');
  document.getElementById('k-out').textContent     = countByState('out');
  document.getElementById('k-repair').textContent  = countByState('repair');
  document.getElementById('k-retired').textContent = countByState('retired');

  const tbody = document.querySelector('#tbl tbody');
  const empty = document.getElementById('empty'
