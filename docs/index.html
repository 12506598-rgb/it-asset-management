<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IT ìì‚° ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</title>
<style>
  :root { --bg:#0f1116; --card:#161a22; --text:#e5e7eb; --muted:#9ca3af; --line:#2a2f3a; }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto; background:var(--bg); color:var(--text);}
  .wrap { max-width:1100px; margin:32px auto; padding:0 16px; }
  h1 { margin:0 0 8px; }
  .sub { color:var(--muted); margin:0 0 24px; }
  .toolbar { display:flex; gap:12px; flex-wrap:wrap; margin-bottom:16px; }
  input, select { background:#0b0e14; color:var(--text); border:1px solid var(--line); border-radius:8px; padding:10px 12px; }
  table { width:100%; border-collapse:collapse; background:var(--card); border:1px solid var(--line); border-radius:12px; overflow:hidden; }
  th, td { padding:12px; border-bottom:1px solid var(--line); text-align:left; }
  th { background:#121620; color:#cfd5e1; font-weight:600; }
  tr:hover { background:#0f1420; }
  .badge { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid var(--line); color:#d1d5db;}
  .empty { color:var(--muted); text-align:center; padding:32px; }
  .kpi { display:flex; gap:12px; margin:0 0 16px; flex-wrap:wrap; }
  .kpi .card { background:var(--card); border:1px solid var(--line); border-radius:12px; padding:12px 16px; }
  .kpi .n { font-size:20px; font-weight:700; }
</style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ’¼ IT ìì‚° ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h1>
  <p class="sub">GitHub Issues â†’ JSON(ì•¡ì…˜) â†’ GitHub Pages</p>

  <div class="kpi">
    <div class="card">ì´ ìì‚° <div class="n" id="k-total">0</div></div>
    <div class="card">ì‚¬ìš© ì¤‘ <div class="n" id="k-inuse">0</div></div>
    <div class="card">ì¬ê³  <div class="n" id="k-stock">0</div></div>
    <div class="card">ìˆ˜ë¦¬ì¤‘ <div class="n" id="k-repair">0</div></div>
    <div class="card">íê¸° <div class="n" id="k-retired">0</div></div>
  </div>

  <div class="toolbar">
    <input id="q" placeholder="ê²€ìƒ‰: ì œëª©/ë³¸ë¬¸/ë‹´ë‹¹ì/ëª¨ë¸ëª…â€¦" />
    <select id="status">
      <option value="">ìƒíƒœ(ë¼ë²¨) ì „ì²´</option>
      <option value="in-use">in-use</option>
      <option value="stock">stock</option>
      <option value="repair">repair</option>
      <option value="retired">retired</option>
      <option value="lost">lost</option>
    </select>
    <select id="state">
      <option value="">ì´ìŠˆ ìƒíƒœ ì „ì²´</option>
      <option value="open">open</option>
      <option value="closed">closed</option>
    </select>
  </div>

  <table id="tbl">
    <thead>
      <tr>
        <th style="width:72px">#</th>
        <th>ì œëª©</th>
        <th style="width:140px">ë¼ë²¨</th>
        <th style="width:180px">ë‹´ë‹¹ì</th>
        <th style="width:150px">êµ¬ë§¤ì¼</th>
        <th style="width:120px">ìƒíƒœ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div class="empty" id="empty" style="display:none;">í‘œì‹œí•  ìì‚°ì´ ì—†ìŠµë‹ˆë‹¤.</div>
</div>

<script>
async function main(){
  // Pagesê°€ ê°™ì€ í´ë”(/docs)ë¥¼ ë£¨íŠ¸ë¡œ ë³´ë‹ˆ ìƒëŒ€ê²½ë¡œë¡œ ì½ìœ¼ë©´ ë¨
  const res = await fetch('assets.json', {cache:'no-store'});
  const issues = await res.json();

  // KPI
  document.getElementById('k-total').textContent   = issues.length;
  const countBy = (label) => issues.filter(i => (i.labels||[]).map(x=>x.toLowerCase()).includes(label)).length;
  document.getElementById('k-inuse').textContent   = countBy('in-use');
  document.getElementById('k-stock').textContent   = countBy('stock');
  document.getElementById('k-repair').textContent  = countBy('repair');
  document.getElementById('k-retired').textContent = countBy('retired');

  const tbody = document.querySelector('#tbl tbody');
  const empty = document.getElementById('empty');

  function render(){
    const q = document.getElementById('q').value.trim().toLowerCase();
    const st = document.getElementById('status').value;
    const istate = document.getElementById('state').value;

    const rows = issues.filter(i=>{
      const labelHit = st ? (i.labels||[]).map(x=>x.toLowerCase()).includes(st) : true;
      const stateHit = istate ? i.state === istate : true;
      const hay = (i.title + ' ' + (i.body||'') + ' ' + (i.labels||[]).join(' ')).toLowerCase();
      const qHit = q ? hay.includes(q) : true;
      return labelHit && stateHit && qHit;
    });

    tbody.innerHTML = rows.map(i=>{
      const labels = (i.labels||[]).map(l=>`<span class="badge">${l}</span>`).join(' ');
      const m = (i.body||'').match(/ë‹´ë‹¹ì:\s*(.+)/);
      const m2 = (i.body||'').match(/êµ¬ë§¤ì¼:\s*([0-9\-\.\/]+)/);
      return `<tr>
        <td>${i.number}</td>
        <td>${i.title}</td>
        <td>${labels || '-'}</td>
        <td>${m?m[1].trim():'-'}</td>
        <td>${m2?m2[1].replace(/\./g,'-'):'-'}</td>
        <td>${i.state}</td>
      </tr>`;
    }).join('');

    empty.style.display = rows.length ? 'none' : 'block';
  }

  ['q','status','state'].forEach(id=>document.getElementById(id).addEventListener('input', render));
  render();
}
main().catch(e=>{ console.error(e); document.getElementById('empty').style.display='block'; });
</script>
</body>
</html>
