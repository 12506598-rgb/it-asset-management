<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IT 자산 관리 대시보드</title>

<style>
  :root {
    --bg:#0f1116;
    --card:#161a22;
    --text:#e5e7eb;
    --muted:#9ca3af;
    --line:#2a2f3a;
  }

  body {
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto;
    background:var(--bg);
    color:var(--text);
  }

  .wrap {
    max-width:1100px;
    margin:32px auto;
    padding:0 16px;
  }

  h1 { margin:0 0 24px; }

  /* KPI */
  .kpi {
    display:flex;
    gap:12px;
    margin-bottom:12px;
    flex-wrap:wrap;
  }

  .kpi .card {
    background:var(--card);
    border:1px solid var(--line);
    border-radius:12px;
    padding:12px 16px;
    min-width:110px;
    cursor:pointer;
  }
  .kpi .card.active {
    border-color:#4b5563;
    box-shadow:0 0 0 1px #4b5563;
  }

  .kpi .n {
    font-size:20px;
    font-weight:700;
  }

  /* 요약 */
  .summary{
    margin: 0 0 16px;
    background: var(--card);
    border:1px solid var(--line);
    border-radius:12px;
    padding:12px 16px;
  }
  .summary h2{
    margin:0 0 10px;
    font-size:14px;
    color:#cfd5e1;
  }
  .summary table{
    width:100%;
    border-collapse:collapse;
  }
  .summary th, .summary td{
    padding:8px 10px;
    border-bottom:1px solid var(--line);
    font-size:13px;
  }
  .summary th{
    background:#121620;
    font-weight:600;
  }
  .num { text-align:right; }

  /* 필터 */
  .toolbar {
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    margin-bottom:16px;
  }

  input, select {
    background:#0b0e14;
    color:var(--text);
    border:1px solid var(--line);
    border-radius:8px;
    padding:10px 12px;
  }

  /* 테이블 */
  table {
    width:100%;
    border-collapse:collapse;
    background:var(--card);
    border:1px solid var(--line);
    border-radius:12px;
    overflow:hidden;
  }

  th, td {
    padding:12px;
    border-bottom:1px solid var(--line);
  }

  th {
    background:#121620;
    font-weight:600;
  }

  tr:hover { background:#0f1420; }

  /* 상태 배지 */
  .badge {
    padding:3px 10px;
    border-radius:999px;
    font-size:12px;
    font-weight:600;
    color:#fff;
  }
  .in { background:#16a34a; }       /* 초록 */
  .out { background:#f97316; }      /* 주황 */
  .repair { background:#6b7280; }   /* 회색 */
  .retired { background:#dc2626; }  /* 빨강 */

  .btn {
    padding:6px 10px;
    border-radius:8px;
    border:1px solid var(--line);
    background:#0b0e14;
    color:var(--text);
    cursor:pointer;
    font-size:12px;
  }

  .empty {
    color:var(--muted);
    text-align:center;
    padding:32px;
  }
</style>
</head>

<body>
<div class="wrap">
  <h1>IT 자산 관리 대시보드</h1>

  <!-- KPI -->
  <div class="kpi">
    <div class="card" id="card-total">총 자산<div class="n" id="k-total">0</div></div>
    <div class="card" id="card-in">IN<div class="n" id="k-in">0</div></div>
    <div class="card" id="card-out">OUT<div class="n" id="k-out">0</div></div>
    <div class="card" id="card-repair">수리중<div class="n" id="k-repair">0</div></div>
    <div class="card" id="card-retired">폐기<div class="n" id="k-retired">0</div></div>
  </div>

  <!-- 요약 -->
  <div class="summary" id="summary"></div>

  <!-- 필터 -->
  <div class="toolbar">
    <input id="q" placeholder="검색" />
    <select id="status">
      <option value="">상태 전체</option>
      <option value="in">IN</option>
      <option value="out">OUT</option>
      <option value="repair">수리중</option>
      <option value="retired">폐기</option>
    </select>
  </div>

  <!-- 테이블 -->
  <table>
    <thead>
      <tr>
        <th>#</th><th>구분</th><th>모델명</th><th>시리얼</th>
        <th>사용자</th><th>구매일</th><th>상태</th><th>인쇄</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <div class="empty" id="empty" style="display:none;">표시할 자산이 없습니다.</div>
</div>

<script>
async function main(){
  const res = await fetch('assets.json', {cache:'no-store'});
  const issues = await res.json();

  const assets = issues.map(i=>{
    const body=i.body||'';
    const labels=(i.labels||[]).map(l=>l.toLowerCase());
    let state='';
    if(labels.includes('in')) state='IN';
    else if(labels.includes('out')) state='OUT';
    else if(labels.includes('repair')) state='수리중';
    else if(labels.includes('retired')) state='폐기';

    const pick=r=>(body.match(r)?.[1]||'-').trim();
    return {
      number:i.number,
      type:pick(/구분:\s*(.+)/),
      model:i.title,
      serial:pick(/시리얼:\s*(.+)/),
      user:pick(/사용자:\s*(.+)/),
      buy:pick(/구매일:\s*([0-9\-\.]+)/).replace(/\./g,'-'),
      state
    };
  });

  // KPI
  k('k-total',assets.length);
  k('k-in',assets.filter(a=>a.state==='IN').length);
  k('k-out',assets.filter(a=>a.state==='OUT').length);
  k('k-repair',assets.filter(a=>a.state==='수리중').length);
  k('k-retired',assets.filter(a=>a.state==='폐기').length);

  const tbody=g('tbody'), empty=g('empty'), summary=g('summary');

  function renderSummary(mode){
    let title='전체 자산 현황';
    let cols=['IN','OUT','수리중','폐기'];
    let list=assets;

    if(mode!=='total'){
      title=mode.toUpperCase()+' 자산 현황';
      cols=[mode.toUpperCase()];
      list=assets.filter(a=>a.state===cols[0]);
    }

    const map={};
    list.forEach(a=>{
      map[a.type]=map[a.type]||{count:0};
      map[a.type].count++;
    });

    summary.innerHTML=`
      <h2>${title}</h2>
      <table>
        <tr><th>구분</th><th class="num">수량</th></tr>
        ${Object.entries(map).map(([k,v])=>`<tr><td>${k}</td><td class="num">${v.count}</td></tr>`).join('')}
      </table>`;
  }

  function render(){
    const q=g('q').value;
    const st=g('status').value.toUpperCase();
    const rows=assets.filter(a=>(!st||a.state===st)&&(!q||JSON.stringify(a).includes(q)));
    tbody.innerHTML=rows.map(a=>`
      <tr>
        <td>${a.number}</td><td>${a.type}</td><td>${a.model}</td><td>${a.serial}</td>
        <td>${a.user}</td><td>${a.buy}</td>
        <td><span class="badge ${cls(a.state)}">${a.state}</span></td>
        <td><button class="btn" onclick="print()">인쇄</button></td>
      </tr>`).join('');
    empty.style.display=rows.length?'none':'block';
  }

  function activate(id){
    ['total','in','out','repair','retired'].forEach(x=>g('card-'+x).classList.remove('active'));
    g('card-'+id).classList.add('active');
    renderSummary(id);
  }

  ['total','in','out','repair','retired'].forEach(id=>{
    g('card-'+id).onclick=()=>activate(id);
  });

  g('q').oninput=render;
  g('status').onchange=render;

  activate('total');
  render();
}

function g(id){return document.getElementById(id);}
function k(id,v){g(id).textContent=v;}
function cls(s){return s==='IN'?'in':s==='OUT'?'out':s==='수리중'?'repair':'retired';}

main();
</script>
</body>
</html>
