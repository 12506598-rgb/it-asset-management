<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IT ìì‚° ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</title>
<style>
  :root { --bg:#0f1116; --card:#161a22; --text:#e5e7eb; --muted:#9ca3af; --line:#2a2f3a; }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto; background:var(--bg); color:var(--text);}
  .wrap { max-width:1100px; margin:32px auto; padding:0 16px; }
  h1 { margin:0 0 8px; }
  .sub { color:var(--muted); margin:0 0 24px; }
  .toolbar { display:flex; gap:12px; flex-wrap:wrap; margin-bottom:16px; }
  input, select { background:#0b0e14; color:var(--text); border:1px solid var(--line); border-radius:8px; padding:10px 12px; }
  table { width:100%; border-collapse:collapse; background:var(--card); border:1px solid var(--line); border-radius:12px; overflow:hidden; }
  th, td { padding:12px; border-bottom:1px solid var(--line); text-align:left; }
  th { background:#121620; color:#cfd5e1; font-weight:600; }
  tr:hover { background:#0f1420; }
  .badge { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid var(--line); color:#d1d5db;}
  .empty { color:var(--muted); text-align:center; padding:32px; }
  .kpi { display:flex; gap:12px; margin:0 0 16px; flex-wrap:wrap; }
  .kpi .card { background:var(--card); border:1px solid var(--line); border-radius:12px; padding:12px 16px; }
  .kpi .n { font-size:20px; font-weight:700; }
</style>
</head>
<body>
<div class="wrap">
  <h1>ğŸ’¼ IT ìì‚° ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</h1>
  <p class="sub">GitHub Issues â†’ JSON(ì•¡ì…˜) â†’ GitHub Pages</p>

  <!-- KPI ì¹´ë“œ: ì´ ìì‚° / IN / OUT / ìˆ˜ë¦¬ì¤‘ / íê¸° -->
  <div class="kpi">
    <div class="card">ì´ ìì‚° <div class="n" id="k-total">0</div></div>
    <div class="card">IN <div class="n" id="k-in">0</div></div>
    <div class="card">OUT <div class="n" id="k-out">0</div></div>
    <div class="card">ìˆ˜ë¦¬ì¤‘ <div class="n" id="k-repair">0</div></div>
    <div class="card">íê¸° <div class="n" id="k-retired">0</div></div>
  </div>

  <!-- ê²€ìƒ‰ / í•„í„° ì˜ì—­ -->
  <div class="toolbar">
    <input id="q" placeholder="ê²€ìƒ‰: ëª¨ë¸ëª…/ë³¸ë¬¸/ì‚¬ìš©ì/ì‹œë¦¬ì–¼â€¦" />
    <select id="status">
      <option value="">ìƒíƒœ(IN/OUT/ìˆ˜ë¦¬/íê¸°) ì „ì²´</option>
      <option value="in">IN</option>
      <option value="out">OUT</option>
      <option value="repair">ìˆ˜ë¦¬ì¤‘</option>
      <option value="retired">íê¸°</option>
      <option value="lost">ë¶„ì‹¤</option>
    </select>
    <select id="state">
      <option value="">ì´ìŠˆ ìƒíƒœ ì „ì²´</option>
      <option value="open">open</option>
      <option value="closed">closed</option>
    </select>
  </div>

  <!-- ìì‚° í…Œì´ë¸”: ëª¨ë¸ëª… / ì‹œë¦¬ì–¼ ë²ˆí˜¸ / ì‚¬ìš©ì / êµ¬ë§¤ì¼ / ìƒíƒœ -->
  <table id="tbl">
    <thead>
      <tr>
        <th style="width:72px">#</th>
        <th>ëª¨ë¸ëª…</th>
        <th style="width:180px">ì‹œë¦¬ì–¼ ë²ˆí˜¸</th>
        <th style="width:180px">ì‚¬ìš©ì</th>
        <th style="width:150px">êµ¬ë§¤ì¼</th>
        <th style="width:120px">ìƒíƒœ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div class="empty" id="empty" style="display:none;">í‘œì‹œí•  ìì‚°ì´ ì—†ìŠµë‹ˆë‹¤.</div>
</div>

<script>
async function main(){
  // Pagesê°€ ê°™ì€ í´ë”(/docs)ë¥¼ ë£¨íŠ¸ë¡œ ë³´ë‹ˆ ìƒëŒ€ê²½ë¡œë¡œ ì½ìœ¼ë©´ ë¨
  const res = await fetch('assets.json', {cache:'no-store'});
  const issues = await res.json();

  // ---------- KPI ê³„ì‚° ----------
  document.getElementById('k-total').textContent = issues.length;

  const countBy = (label) =>
    issues.filter(i => {
      const labels = (i.labels || []).map(x =>
        (typeof x === 'string' ? x : (x.name || '')).toLowerCase()
      );
      return labels.includes(label);
    }).length;

  // ë¼ë²¨ ì´ë¦„ ê¸°ì¤€: in / out / repair / retired / lost
  document.getElementById('k-in').textContent      = countBy('in');
  document.getElementById('k-out').textContent     = countBy('out');
  document.getElementById('k-repair').textContent  = countBy('repair');
  document.getElementById('k-retired').textContent = countBy('retired');

  const tbody = document.querySelector('#tbl tbody');
  const empty = document.getElementById('empty');

  function render(){
    const q      = document.getElementById('q').value.trim().toLowerCase();
    const st     = document.getElementById('status').value;  // in / out / repair / retired / lost
    const istate = document.getElementById('state').value;   // open / closed

    const rows = issues.filter(i => {
      const labels = (i.labels || []).map(x =>
        (typeof x === 'string' ? x : (x.name || '')).toLowerCase()
      );

      const labelHit = st ? labels.includes(st) : true;
      const stateHit = istate ? i.state === istate : true;

      const hay = (
        i.title + ' ' +
        (i.body || '') + ' ' +
        labels.join(' ')
      ).toLowerCase();
      const qHit = q ? hay.includes(q) : true;

      return labelHit && stateHit && qHit;
    });

    tbody.innerHTML = rows.map(i => {
      const body = i.body || '';

      // ëª¨ë¸ëª… = ì´ìŠˆ ì œëª©
      const model = i.title;

      // ì‹œë¦¬ì–¼ ë²ˆí˜¸: "ì‹œë¦¬ì–¼:" íŒ¨í„´ì—ì„œ ì¶”ì¶œ
      const mSerial = body.match(/ì‹œë¦¬ì–¼:\s*(.+)/);
      const serial = mSerial ? mSerial[1].trim() : '-';

      // ì‚¬ìš©ì: "ì‚¬ìš©ì:" ë˜ëŠ” ê¸°ì¡´ "ë‹´ë‹¹ì:" íŒ¨í„´ì—ì„œ ì¶”ì¶œ
      let mUser = body.match(/ì‚¬ìš©ì:\s*(.+)/);
      if (!mUser) mUser = body.match(/ë‹´ë‹¹ì:\s*(.+)/);
      const user = mUser ? mUser[1].trim() : '-';

      // êµ¬ë§¤ì¼
      const mBuy = body.match(/êµ¬ë§¤ì¼:\s*([0-9\-\.\/]+)/);
      const buy  = mBuy ? mBuy[1].replace(/\./g,'-') : '-';

      // ìƒíƒœ: ë¼ë²¨ì— ë”°ë¼ IN / OUT / ìˆ˜ë¦¬ì¤‘ / íê¸° / ë¶„ì‹¤ í‘œì‹œ
      const labels = (i.labels || []).map(x =>
        (typeof x === 'string' ? x : (x.name || '')).toLowerCase()
      );
      let state = '-';
      if (labels.includes('in'))       state = 'IN';
      else if (labels.includes('out')) state = 'OUT';
      else if (labels.includes('repair'))   state = 'ìˆ˜ë¦¬ì¤‘';
      else if (labels.includes('retired'))  state = 'íê¸°';
      else if (labels.includes('lost'))     state = 'ë¶„ì‹¤';

      return `<tr>
        <td>${i.number}</td>
        <td>${model}</td>
        <td>${serial}</td>
        <td>${user}</td>
        <td>${buy}</td>
        <td>${state}</td>
      </tr>`;
    }).join('');

    empty.style.display = rows.length ? 'none' : 'block';
  }

  ['q','status','state'].forEach(id =>
    document.getElementById(id).addEventListener('input', render)
  );
  render();
}

main().catch(e => {
  console.error(e);
  document.getElementById('empty').style.display='block';
});
</script>
</body>
</html>
