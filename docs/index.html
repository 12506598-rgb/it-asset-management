<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IT 자산 관리 대시보드</title>

<style>
  :root{
    --bg: radial-gradient(1200px 600px at 20% -10%, #1b2559 0%, #0b0f1a 45%, #05070c 100%);
    --card: rgba(18, 24, 48, 0.86);
    --text: #e8ecff;
    --muted: #9aa4ff;
    --line: rgba(120, 140, 255, 0.18);
    --accent: #6cf0ff;
    --accent2: #a78bfa;
    --shadow: 0 20px 60px rgba(0,0,0,.45);
  }

  *{ box-sizing: border-box; }

  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    position: relative;
  }

  /* 정적 별 배경 */
  body::before{
    content:"";
    position: fixed;
    inset: 0;
    pointer-events: none;
    opacity: .3;
    background-image:
      radial-gradient(1px 1px at 15% 20%, #fff, transparent),
      radial-gradient(1px 1px at 30% 80%, #fff, transparent),
      radial-gradient(1px 1px at 55% 35%, #fff, transparent),
      radial-gradient(1px 1px at 70% 60%, #fff, transparent),
      radial-gradient(1px 1px at 85% 25%, #fff, transparent);
  }

  .wrap{
    max-width:1100px;
    margin:36px auto;
    padding:0 16px;
    position: relative;
    z-index: 1;
  }

  h1{ margin:0 0 8px; }
  .sub{ color: var(--muted); margin-bottom: 24px; }

  /* KPI */
  .kpi{ display:flex; gap:12px; margin-bottom:12px; flex-wrap:wrap; }
  .kpi .card{
    background: var(--card);
    border:1px solid var(--line);
    border-radius:16px;
    padding:12px 16px;
    cursor:pointer;
    box-shadow: var(--shadow);
  }
  .kpi .card.active{
    border-color: var(--accent2);
    box-shadow: 0 0 18px rgba(167,139,250,.5);
  }
  .kpi .n{ font-size:22px; font-weight:800; color: var(--accent); }

  /* 상태 배지 */
  .badge{
    padding:4px 10px;
    border-radius:999px;
    font-size:12px;
    font-weight:600;
    display:inline-block;
    border:1px solid transparent;
  }
  .st-in{ color:#6cf0ff; border-color:#6cf0ff; box-shadow:0 0 8px rgba(108,240,255,.5); }
  .st-out{ color:#fbbf24; border-color:#fbbf24; box-shadow:0 0 8px rgba(251,191,36,.5); }
  .st-repair{ color:#a78bfa; border-color:#a78bfa; box-shadow:0 0 8px rgba(167,139,250,.5); }
  .st-retired{ color:#9ca3af; border-color:#9ca3af; }
  .st-lost{ color:#f87171; border-color:#f87171; box-shadow:0 0 8px rgba(248,113,113,.5); }

  /* 버튼 */
  .btn{
    padding:6px 10px;
    border-radius:8px;
    border:1px solid var(--line);
    background:rgba(20,25,60,.8);
    color:var(--accent);
    cursor:pointer;
    font-size:12px;
  }
  .btn:hover{ box-shadow:0 0 8px rgba(108,240,255,.4); }

  table{
    width:100%;
    border-collapse:collapse;
    background: var(--card);
    border-radius:16px;
    overflow:hidden;
    box-shadow: var(--shadow);
  }
  th, td{ padding:12px; border-bottom:1px solid var(--line); }
  th{ background:rgba(120,140,255,.15); }
  tr:hover{ background:rgba(120,140,255,.08); }

</style>
</head>

<body>
<div class="wrap">
  <h1>IT 자산 관리 대시보드</h1>
  <p class="sub">GitHub Issues → JSON(액션) → GitHub Pages</p>

  <div class="kpi">
    <div class="card active">총 자산<div class="n" id="k-total">0</div></div>
    <div class="card">IN<div class="n" id="k-in">0</div></div>
    <div class="card">OUT<div class="n" id="k-out">0</div></div>
    <div class="card">수리중<div class="n" id="k-repair">0</div></div>
    <div class="card">폐기<div class="n" id="k-retired">0</div></div>
  </div>

  <table id="tbl">
    <thead>
      <tr>
        <th>#</th>
        <th>구분</th>
        <th>모델명</th>
        <th>시리얼</th>
        <th>사용자</th>
        <th>구매일</th>
        <th>상태</th>
        <th>바코드</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
async function main(){
  const issues = await (await fetch('assets.json')).json();
  const tbody = document.querySelector('#tbl tbody');

  let total=0,inC=0,outC=0,rep=0,ret=0;

  tbody.innerHTML = issues.map(i=>{
    const body=i.body||'';
    const serial=(body.match(/시리얼:\s*(.+)/)||[])[1]||'-';
    const user=(body.match(/사용자:\s*(.+)/)||[])[1]||'-';
    const buy=(body.match(/구매일:\s*(.+)/)||[])[1]||'-';
    const type=(body.match(/구분:\s*(.+)/)||[])[1]||'-';

    const labels=(i.labels||[]).map(l=>l.toLowerCase());
    let st='-',cls='';
    if(labels.includes('in')){st='IN';cls='st-in';inC++;}
    else if(labels.includes('out')){st='OUT';cls='st-out';outC++;}
    else if(labels.includes('repair')){st='수리중';cls='st-repair';rep++;}
    else if(labels.includes('retired')){st='폐기';cls='st-retired';ret++;}
    else if(labels.includes('lost')){st='분실';cls='st-lost';}

    total++;

    return `<tr>
      <td>${i.number}</td>
      <td>${type}</td>
      <td>${i.title}</td>
      <td>${serial}</td>
      <td>${user}</td>
      <td>${buy}</td>
      <td><span class="badge ${cls}">${st}</span></td>
      <td><button class="btn" onclick="barcode('${serial}')">출력</button></td>
    </tr>`;
  }).join('');

  k-total.textContent=total;
  k-in.textContent=inC;
  k-out.textContent=outC;
  k-repair.textContent=rep;
  k-retired.textContent=ret;
}

function barcode(code){
  const w=window.open('','_blank','width=400,height=300');
  w.document.write(`
    <h3>자산 바코드</h3>
    <svg id="b"></svg>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"><\/script>
    <script>JsBarcode("#b","${code}",{displayValue:true});<\/script>
  `);
}

main();
</script>
</body>
</html>
